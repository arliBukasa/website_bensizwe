<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>

    <!-- Liste des formations du candidat -->
    <template id="portal_my_formations" name="Mes formations">
      <t t-call="portal.portal_layout">
        <t t-set="breadcrumbs_searchbar" t-value="True"/>

        <t t-call="portal.portal_searchbar">
          <t t-set="title">Formations</t>
        </t>

        <div class="container mt-3">
          <div class="row">
            <div class="col-12">
              <div class="alert alert-info" t-if="not formations">
                <h4>Aucune inscription trouvée</h4>
                <p>Vous n'êtes inscrit à aucune formation pour le moment.</p>
                <a href="/formations" class="btn btn-primary">
                  <i class="fa fa-graduation-cap me-2"></i>Découvrir nos formations
                </a>
              </div>

              <div t-if="formations" class="row">
                <t t-foreach="formations" t-as="registration">
                  <div class="col-lg-6 col-xl-4 mb-4">
                    <div class="card h-100 shadow-sm">
                      <div class="card-header d-flex justify-content-between align-items-center">
                        <small class="text-muted">
                          <i class="fa fa-calendar me-1"></i>
                          Inscrit le <t t-esc="registration.registration_date"/>
                        </small>
                        <span t-if="registration.state == 'registered'" class="badge bg-success">Inscrit</span>
                        <span t-elif="registration.state == 'confirmed'" class="badge bg-primary">Confirmé</span>
                        <span t-elif="registration.state == 'cancelled'" class="badge bg-danger">Annulé</span>
                        <span t-else="" class="badge bg-secondary" t-esc="registration.state"/>
                      </div>
                      
                      <div class="card-body">
                        <h5 class="card-title">
                          <i class="fa fa-graduation-cap me-2 text-primary"></i>
                          <t t-esc="registration.training_id.name"/>
                        </h5>
                        
                        <div class="mb-3">
                          <div class="row">
                            <div class="col-6">
                              <small class="text-muted">Date de début:</small>
                              <br/>
                              <span t-if="registration.training_id.start_date" t-esc="registration.training_id.start_date"/>
                              <span t-else="" class="text-muted">À définir</span>
                            </div>
                            <div class="col-6">
                              <small class="text-muted">Durée:</small>
                              <br/>
                              <span t-if="registration.training_id.duration" t-esc="registration.training_id.duration"/>
                              <span t-else="" class="text-muted">À définir</span>
                            </div>
                          </div>
                        </div>

                        <div class="mb-3" t-if="registration.training_id.price">
                          <small class="text-muted">Prix:</small>
                          <br/>
                          <span class="text-success fw-bold">
                            <t t-esc="registration.training_id.price"/> FCFA
                          </span>
                        </div>

                        <div t-if="registration.training_id.description" class="mb-3">
                          <small class="text-muted">Description:</small>
                          <div class="text-truncate" style="max-height: 60px; overflow: hidden;">
                            <t t-field="registration.training_id.description"/>
                          </div>
                        </div>
                      </div>
                      
                      <div class="card-footer bg-transparent">
                        <div class="d-flex justify-content-between align-items-center">
                          <small class="text-muted">
                            #<t t-esc="registration.id"/>
                          </small>
                          <a t-attf-href="/my/formation/#{registration.id}" class="btn btn-outline-primary btn-sm">
                            <i class="fa fa-eye me-1"></i>Détails
                          </a>
                        </div>
                      </div>
                    </div>
                  </div>
                </t>
              </div>

              <!-- Pagination -->
              <div t-if="pager" class="o_portal_pager text-center">
                <t t-call="portal.pager"/>
              </div>
            </div>
          </div>
        </div>
      </t>
    </template>

    <!-- Détail d'une inscription -->
    <template id="portal_formation_detail" name="Détail formation">
      <t t-call="portal.portal_layout">
        <t t-call="portal.portal_record_layout">
          <t t-set="card_header">
            <div class="row no-gutters">
              <div class="col-12">
                <h5 class="mb-0">
                  <span t-if="registration.state == 'registered'" class="badge bg-success me-2">Inscrit</span>
                  <span t-elif="registration.state == 'confirmed'" class="badge bg-primary me-2">Confirmé</span>
                  <span t-elif="registration.state == 'cancelled'" class="badge bg-danger me-2">Annulé</span>
                  <span t-else="" class="badge bg-secondary me-2" t-esc="registration.state"/>
                  Formation: <span t-esc="formation.name"/>
                </h5>
              </div>
            </div>
          </t>

          <t t-set="card_body">
            <div class="row">
              <div class="col-lg-8">
                <div class="card mb-4">
                  <div class="card-header">
                    <h6 class="mb-0">
                      <i class="fa fa-graduation-cap me-2"></i>
                      Informations sur la formation
                    </h6>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-6">
                        <p><strong>Nom:</strong> <t t-esc="formation.name"/></p>
                        <p><strong>Date de début:</strong> 
                          <span t-if="formation.start_date" t-esc="formation.start_date"/>
                          <span t-else="" class="text-muted">À définir</span>
                        </p>
                        <p><strong>Durée:</strong> 
                          <span t-if="formation.duration" t-esc="formation.duration"/>
                          <span t-else="" class="text-muted">À définir</span>
                        </p>
                      </div>
                      <div class="col-md-6">
                        <p><strong>Prix:</strong> 
                          <span t-if="formation.price" class="text-success">
                            <t t-esc="formation.price"/> FCFA
                          </span>
                          <span t-else="" class="text-success">Gratuit</span>
                        </p>
                        <p><strong>Places disponibles:</strong> 
                          <span t-if="formation.max_participants" class="text-info">
                            <t t-esc="formation.available_spots"/> / <t t-esc="formation.max_participants"/>
                          </span>
                          <span t-else="" class="text-info">Illimitées</span>
                        </p>
                      </div>
                    </div>
                    
                    <div t-if="formation.description" class="mt-3">
                      <strong>Description:</strong>
                      <div class="mt-2" t-field="formation.description"/>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-lg-4">
                <div class="card">
                  <div class="card-header">
                    <h6 class="mb-0">
                      <i class="fa fa-info-circle me-2"></i>
                      Votre inscription
                    </h6>
                  </div>
                  <div class="card-body">
                    <p><strong>Numéro:</strong> #<t t-esc="registration.id"/></p>
                    <p><strong>Date d'inscription:</strong> <t t-esc="registration.registration_date"/></p>
                    <p><strong>Statut:</strong> 
                      <span t-if="registration.state == 'registered'" class="badge bg-success">Inscrit</span>
                      <span t-elif="registration.state == 'confirmed'" class="badge bg-primary">Confirmé</span>
                      <span t-elif="registration.state == 'cancelled'" class="badge bg-danger">Annulé</span>
                      <span t-else="" class="badge bg-secondary" t-esc="registration.state"/>
                    </p>
                    
                    <hr/>
                    
                    <div class="d-grid gap-2">
                      <a href="/my/formations" class="btn btn-outline-secondary">
                        <i class="fa fa-arrow-left me-2"></i>Retour à mes formations
                      </a>
                      
                      <t t-if="registration.state == 'registered'">
                        <a href="/formations" class="btn btn-primary">
                          <i class="fa fa-graduation-cap me-2"></i>Voir d'autres formations
                        </a>
                      </t>
                    </div>
                  </div>
                </div>

                <!-- Informations de contact -->
                <div class="card mt-3">
                  <div class="card-header">
                    <h6 class="mb-0">
                      <i class="fa fa-phone me-2"></i>
                      Besoin d'aide ?
                    </h6>
                  </div>
                  <div class="card-body">
                    <p class="small">
                      Pour toute question concernant votre inscription ou la formation, 
                      n'hésitez pas à nous contacter.
                    </p>
                    <div class="d-grid">
                      <a href="/contactus" class="btn btn-outline-primary btn-sm">
                        <i class="fa fa-envelope me-2"></i>Nous contacter
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </t>
        </t>
      </t>
    </template>

  </data>
</odoo>
